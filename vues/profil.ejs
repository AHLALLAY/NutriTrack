<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= titre %></title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Remix Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <!-- Configuration Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'nutri-green': '#10B981',
                        'nutri-blue': '#0EA5E9',
                        'nutri-orange': '#f59e0b'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-white min-h-screen">
    
    <!-- Messages de notification -->
    <% if (typeof erreur !== 'undefined' && erreur) { %>
        <div class="fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-lg z-50" id="message-erreur">
            <div class="flex items-center">
                <i class="ri-error-warning-line mr-2"></i>
                <span><%= erreur %></span>
                <button onclick="fermerMessage('message-erreur')" class="ml-4 text-red-500 hover:text-red-700">
                    <i class="ri-close-line"></i>
                </button>
            </div>
        </div>
    <% } %>
    
    <% if (typeof succes !== 'undefined' && succes) { %>
        <div class="fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg shadow-lg z-50" id="message-succes">
            <div class="flex items-center">
                <i class="ri-checkbox-circle-line mr-2"></i>
                <span><%= succes %></span>
                <button onclick="fermerMessage('message-succes')" class="ml-4 text-green-500 hover:text-green-700">
                    <i class="ri-close-line"></i>
                </button>
            </div>
        </div>
    <% } %>

    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-br from-green-400 to-green-600 rounded-xl flex items-center justify-center mr-3 shadow-sm">
                        <i class="ri-leaf-fill text-white text-lg"></i>
                    </div>
                    <span class="text-xl font-bold text-gray-900">NutriTrack</span>
                </div>
                
                <!-- Navigation -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="/tableau-de-bord" class="text-gray-600 hover:text-nutri-green flex items-center font-medium">
                        <i class="ri-dashboard-3-line mr-2"></i>Tableau de bord
                    </a>
                    <a href="#" class="text-gray-600 hover:text-nutri-green flex items-center font-medium">
                        <i class="ri-search-2-line mr-2"></i>Analyser
                    </a>
                    <a href="#" class="text-gray-600 hover:text-nutri-green flex items-center font-medium">
                        <i class="ri-bar-chart-box-line mr-2"></i>Rapports
                    </a>
                </div>
                
                <!-- Icône utilisateur -->
                <div class="w-10 h-10 bg-gradient-to-br from-green-100 to-green-200 rounded-full flex items-center justify-center shadow-sm">
                    <i class="ri-user-3-line text-green-600 text-lg"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Contenu principal -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header avec retour -->
        <div class="flex justify-between items-center mb-8">
            <div class="flex items-center">
                <a href="/tableau-de-bord" class="flex items-center text-gray-600 hover:text-nutri-green">
                    <div class="w-8 h-8 bg-gray-100 hover:bg-green-100 rounded-lg flex items-center justify-center mr-3">
                        <i class="ri-arrow-left-line text-sm"></i>
                    </div>
                    <span class="font-medium">Retour</span>
                </a>
            </div>
        </div>

        <!-- Titre -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Profil & Objectifs</h1>
            <p class="text-[#64748B]">Personnalisez votre expérience NutriTrack</p>
        </div>

        <!-- Onglets -->
        <div class="w-full mb-8">
            <div class="flex bg-[#F8FAFC] rounded-full p-1 w-full">
                <a href="/profil" class="flex-1 px-6 py-3 rounded-full text-sm font-medium text-center <%= ongletActif === 'profil' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900' %>">
                    Profil
                </a>
                <a href="/profil/objectifs" class="flex-1 px-6 py-3 rounded-full text-sm font-medium text-center <%= ongletActif === 'objectifs' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900' %>">
                    Objectifs
                </a>
            </div>
        </div>

        <!-- Contenu desktop -->
        <div class="hidden lg:grid grid-cols-3 gap-8">
            
            <!-- Informations personnelles -->
            <div class="bg-white border border-[#E2E8F0] rounded-[16px] p-6 hover:scale-105 transition-transform duration-500 ease-in-out">
                <div class="flex items-center mb-28">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3">
                        <i class="ri-user-line text-[#1F2937] text-[20px]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900">Informations personnelles</h3>
                </div>
                
                <div class="space-y-3">
                    <div class="text-center">
                        <p class="text-[#1F2937] mb-4 font-bold text-xl"><%= utilisateur.nomComplet %></p>
                        <p class="text-[#64748B] text-sm"><%= utilisateur.email %></p>
                        <p class="inline-block px-4 font-semibold py-1 rounded-full bg-emerald-500/10 text-[#10B981] text-sm mt-2">
                            Membre depuis <%= new Date(utilisateur.dateCreation).toLocaleDateString('fr-FR') %>
                        </p>
                    </div>
                </div>

                <!-- Statistiques -->
                <div class="mt-12 pt-6 ">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center bg-[#F8FAFC] p-4 rounded-[12px]">
                            <div class="text-3xl font-bold text-[#10B981]"><%= statistiques.joursConsecutifs %></div>
                            <div class="text-md text-[#64748B]">Jours consécutifs</div>
                        </div>
                        <div class="text-center bg-[#F8FAFC] p-4 rounded-[12px]">
                            <div class="text-3xl font-bold text-nutri-blue"><%= statistiques.repasAnalyses %></div>
                            <div class="text-md text-[#64748B]">Repas analysés</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Données physiques -->
            <div class="bg-white border border-[#E2E8F0] rounded-[16px] p-6 hover:scale-105 transition-transform duration-500 ease-in-out transition-transform duration-500 ease-in-out">
                <div class="flex items-center mb-4">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3">
                        <i class="ri-pulse-fill text-[#1F2937] text-[20px]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900">Données physiques</h3>
                </div>
                
                <form id="profilForm" action="/profil/mise-a-jour" method="POST" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-[#1F2937] mb-1">Âge</label>
                        <input type="number" name="age" value="<%= profil ? profil.age : '' %>" 
                               class="w-full px-3 py-2 border border-gray-300 text-[#64748B] rounded-md focus:ring-2 focus:ring-nutri-green focus:border-nutri-green" 
                               placeholder="Âge" min="10" max="120">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-[#1F2937] mb-1">Taille (cm)</label>
                            <input type="number" name="taille" value="<%= profil ? profil.taille : '' %>" 
                                   class="w-full px-3 py-2 border text-[#64748B] border-gray-300 rounded-md focus:ring-2 focus:ring-nutri-green focus:border-nutri-green" 
                                   placeholder="Taille" min="100" max="250" step="0.1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-[#1F2937] mb-1">Poids (kg)</label>
                            <input type="number" name="poids" value="<%= profil ? profil.poids : '' %>" 
                                   class="w-full px-3 py-2 border text-[#64748B] border-gray-300 rounded-md focus:ring-2 focus:ring-nutri-green focus:border-nutri-green" 
                                   placeholder="Poids" min="30" max="300" step="0.1">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-[#1F2937] mb-1">Objectif de poids (kg)</label>
                        <input type="number" name="objectifPoids" value="<%= profil && profil.progression ? profil.progression.poidsObjectif : '' %>" 
                               class="w-full px-3 py-2 border text-[#64748B] border-gray-300 rounded-md focus:ring-2 focus:ring-nutri-green focus:border-nutri-green" 
                               placeholder="Objectif" min="30" max="300" step="0.1">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-[#1F2937] mb-1">Type de profil</label>
                        <select name="typeProfil" class="w-full px-3 py-2 border text-[#64748B] border-gray-300 rounded-md focus:ring-2 focus:ring-nutri-green focus:border-nutri-green">
                            <option value="perte_poids" <%= profil && profil.typeProfil === 'perte_poids' ? 'selected' : '' %>>Perte de poids</option>
                            <option value="prise_masse" <%= profil && profil.typeProfil === 'prise_masse' ? 'selected' : '' %>>Prise de masse</option>
                            <option value="diabete" <%= profil && profil.typeProfil === 'diabete' ? 'selected' : '' %>>Diabète</option>
                            <option value="hypertension" <%= profil && profil.typeProfil === 'hypertension' ? 'selected' : '' %>>Hypertension</option>
                            <option value="obesite" <%= profil && profil.typeProfil === 'obesite' ? 'selected' : '' %>>Obésité</option>
                            <option value="athlete" <%= profil && profil.typeProfil === 'athlete' ? 'selected' : '' %>>Athlète</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-[#1F2937] mb-1">Niveau d'activité</label>
                        <select name="activitePhysique" class="w-full px-3 py-2 border text-[#64748B] border-gray-300 rounded-md focus:ring-2 focus:ring-nutri-green focus:border-nutri-green">
                            <option value="sedentaire" <%= profil && profil.activitePhysique === 'sedentaire' ? 'selected' : '' %>>Sédentaire</option>
                            <option value="leger" <%= profil && profil.activitePhysique === 'leger' ? 'selected' : '' %>>Léger</option>
                            <option value="modere" <%= profil && profil.activitePhysique === 'modere' ? 'selected' : '' %>>Modéré</option>
                            <option value="intense" <%= profil && profil.activitePhysique === 'intense' ? 'selected' : '' %>>Intense</option>
                            <option value="tres_intense" <%= profil && profil.activitePhysique === 'tres_intense' ? 'selected' : '' %>>Très intense</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="w-full bg-nutri-green text-white py-2 px-4 rounded-[16px] hover:bg-green-600 shadow-md">
                        <i class="ri-save-line mr-2"></i>Sauvegarder
                    </button>
                </form>
            </div>

            <!-- Progression -->
            <div class="bg-white border border-[#E2E8F0] rounded-[16px] p-6 hover:scale-105 transition-transform duration-500 ease-in-out">
                <div class="flex items-center mb-4">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3">
                        <i class="ri-focus-2-line text-[#1F2937] text-[20px]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900">Progression</h3>
                </div>
                
                <% if (profil && profil.progression) { %>
                    <div class="space-y-10">
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-md text-gray-700">Objectif de poids</span>
                                <span class="text-sm font-medium text-gray-700"><%= profil.progression.difference %>kg restants</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                <div class="bg-nutri-green h-2 rounded-full progress-bar" data-progress="<%= profil.progression.progression %>"></div>
                            </div>
                        </div>
                        
                        <div class="space-y-10">
                            <div class="flex items-center justify-between bg-[#F8FAFC] p-4 rounded-[12px]">
                                <div class="flex items-center">
                                    <i class="ri-scales-line text-[16px] text-green-500 mr-3"></i>
                                    <span class="text-sm text-gray-700">Poids actuel:</span>
                                </div>
                                <strong class="text-sm text-gray-700"><%= profil.poids %>kg</strong>
                            </div>
                            <div class="flex items-center justify-between bg-[#F8FAFC] p-4 rounded-[12px]">
                                <div class="flex items-center">
                                    <i class="ri-focus-2-line text-[16px] text-blue-500 mr-3"></i>
                                    <span class="text-sm text-gray-700">Objectif:</span>
                                </div>
                                <strong class="text-sm text-gray-700"><%= profil.progression.poidsObjectif %>kg</strong>
                            </div>
                            <div class="flex items-center justify-between bg-[#F8FAFC] p-4 rounded-[12px]">
                                <div class="flex items-center">
                                    <i class="ri-ruler-line text-[16px] text-orange-500 mr-3"></i>
                                    <span class="text-sm text-gray-700">IMC:</span>
                                </div>
                                <strong class="text-sm text-gray-700"><%= profil.bmi %></strong>
                            </div>
                        </div>
                    </div>
                <% } else { %>
                    <div class="text-center py-8">
                        <i class="ri-line-chart-line text-6xl text-gray-300 mb-6"></i>
                        <p class="text-gray-500">Complétez vos données physiques pour voir votre progression</p>
                    </div>
                <% } %>
            </div>
        </div>

        <!-- Contenu mobile -->
        <div class="lg:hidden space-y-6">
            
            <!-- Informations personnelles -->
            <div class="bg-white border border-[#E2E8F0] rounded-[16px] p-6 hover:scale-105 transition-transform duration-500 ease-in-out">
                <div class="flex items-center mb-4">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3">
                        <i class="ri-user-line text-[#1F2937] text-[20px]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900">Informations personnelles</h3>
                </div>
                
                <div class="space-y-3">
                    <div class="text-center">
                        <p class="text-[#1F2937] font-bold text-lg"><%= utilisateur.nomComplet %></p>
                        <p class="text-gray-600 text-sm"><%= utilisateur.email %></p>
                        <p class="text-nutri-green text-sm mt-2">Membre depuis <%= new Date(utilisateur.dateCreation).toLocaleDateString('fr-FR') %></p>
                    </div>
                </div>

                <!-- Statistiques -->
                <div class="mt-8 pt-6 border-t border-gray-100 hover:scale-105 transition-transform duration-500 ease-in-out">
                    <div class="grid grid-cols-2 gap-6">
                        <div class="text-center bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4">
                            <div class="text-3xl font-bold text-nutri-green mb-1"><%= statistiques.joursConsecutifs %></div>
                            <div class="text-sm text-gray-600 font-medium">Jours consécutifs</div>
                        </div>
                        <div class="text-center bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4">
                            <div class="text-3xl font-bold text-nutri-blue mb-1"><%= statistiques.repasAnalyses %></div>
                            <div class="text-sm text-gray-600 font-medium">Repas analysés</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Données physiques -->
            <div class="bg-white border border-[#E2E8F0] rounded-[16px] p-6 hover:scale-105 transition-transform duration-500 ease-in-out">
                <div class="flex items-center mb-6">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3">
                        <i class="ri-pulse-fill text-[#1F2937] text-[20px]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900">Données physiques</h3>
                </div>
                
                <form id="profilFormMobile" action="/profil/mise-a-jour" method="POST" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Âge</label>
                        <input type="number" name="age" value="<%= profil ? profil.age : '' %>" 
                               class="w-full px-3 py-2 border text-[#64748B] border-gray-300 rounded-md focus:ring-2 focus:ring-nutri-green focus:border-nutri-green" 
                               placeholder="Âge" min="10" max="120">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Taille (cm)</label>
                            <input type="number" name="taille" value="<%= profil ? profil.taille : '' %>" 
                                   class="w-full px-3 py-2 border text-[#64748B]  border-gray-300 rounded-md focus:ring-2 focus:ring-nutri-green focus:border-nutri-green" 
                                   placeholder="Taille" min="100" max="250" step="0.1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Poids (kg)</label>
                            <input type="number" name="poids" value="<%= profil ? profil.poids : '' %>" 
                                   class="w-full px-3 py-2 border text-[#64748B]  border-gray-300 rounded-md focus:ring-2 focus:ring-nutri-green focus:border-nutri-green" 
                                   placeholder="Poids" min="30" max="300" step="0.1">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Objectif de poids (kg)</label>
                        <input type="number" name="objectifPoids" value="<%= profil && profil.progression ? profil.progression.poidsObjectif : '' %>" 
                               class="w-full px-3 py-2 border text-[#64748B] border-gray-300 rounded-md focus:ring-2 focus:ring-nutri-green focus:border-nutri-green" 
                               placeholder="Objectif" min="30" max="300" step="0.1">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Type de profil</label>
                        <select name="typeProfil" class="w-full px-3 py-2 border text-[#64748B] border-gray-300 rounded-md focus:ring-2 focus:ring-nutri-green focus:border-nutri-green">
                            <option value="perte_poids" <%= profil && profil.typeProfil === 'perte_poids' ? 'selected' : '' %>>Perte de poids</option>
                            <option value="prise_masse" <%= profil && profil.typeProfil === 'prise_masse' ? 'selected' : '' %>>Prise de masse</option>
                            <option value="diabete" <%= profil && profil.typeProfil === 'diabete' ? 'selected' : '' %>>Diabète</option>
                            <option value="hypertension" <%= profil && profil.typeProfil === 'hypertension' ? 'selected' : '' %>>Hypertension</option>
                            <option value="obesite" <%= profil && profil.typeProfil === 'obesite' ? 'selected' : '' %>>Obésité</option>
                            <option value="athlete" <%= profil && profil.typeProfil === 'athlete' ? 'selected' : '' %>>Athlète</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Niveau d'activité</label>
                        <select name="activitePhysique" class="w-full px-3 py-2 border text-[#64748B] border-gray-300 rounded-md focus:ring-2 focus:ring-nutri-green focus:border-nutri-green">
                            <option value="sedentaire" <%= profil && profil.activitePhysique === 'sedentaire' ? 'selected' : '' %>>Sédentaire</option>
                            <option value="leger" <%= profil && profil.activitePhysique === 'leger' ? 'selected' : '' %>>Léger</option>
                            <option value="modere" <%= profil && profil.activitePhysique === 'modere' ? 'selected' : '' %>>Modéré</option>
                            <option value="intense" <%= profil && profil.activitePhysique === 'intense' ? 'selected' : '' %>>Intense</option>
                            <option value="tres_intense" <%= profil && profil.activitePhysique === 'tres_intense' ? 'selected' : '' %>>Très intense</option>
                        </select>
                    </div>
                </form>
            </div>

            <!-- Progression -->
            <div class="bg-white border border-[#E2E8F0] rounded-[16px] p-6 hover:scale-105 transition-transform duration-500 ease-in-out">
                <div class="flex items-center mb-6">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3">
                        <i class="ri-focus-2-line text-[#1F2937] text-[20px]"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900">Progression</h3>
                </div>
                
                <% if (profil && profil.progression) { %>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-sm font-medium text-gray-700">Objectif de poids</span>
                                <span class="text-sm text-gray-500"><%= profil.progression.difference %>kg restants</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                <div class="bg-nutri-green h-2 rounded-full progress-bar" data-progress="<%= profil.progression.progression %>"></div>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex items-center justify-between bg-[#F8FAFC] p-4 rounded-[12px]">
                                <div class="flex items-center">
                                    <i class="ri-scales-line text-[16px] text-green-500 mr-3"></i>
                                    <span class="text-sm text-gray-700">Poids actuel:</span>
                                </div>
                                <strong class="text-sm text-gray-700"><%= profil.poids %>kg</strong>
                            </div>
                            <div class="flex items-center justify-between bg-[#F8FAFC] p-4 rounded-[12px]">
                                <div class="flex items-center">
                                    <i class="ri-focus-2-line text-[16px] text-blue-500 mr-3"></i>
                                    <span class="text-sm text-gray-700">Objectif:</span>
                                </div>
                                <strong class="text-sm text-gray-700"><%= profil.progression.poidsObjectif %>kg</strong>
                            </div>
                            <div class="flex items-center justify-between bg-[#F8FAFC] p-4 rounded-[12px]">
                                <div class="flex items-center">
                                    <i class="ri-ruler-line text-[16px] text-orange-500 mr-3"></i>
                                    <span class="text-sm text-gray-700">IMC:</span>
                                </div>
                                <strong class="text-sm text-gray-700"><%= profil.bmi %></strong>
                            </div>
                        </div>
                    </div>
                <% } else { %>
                    <div class="text-center py-8">
                        <i class="ri-line-chart-line text-6xl text-gray-300 mb-6"></i>
                        <p class="text-gray-500">Complétez vos données physiques pour voir votre progression</p>
                    </div>
                <% } %>
            </div>
        </div>
    </main>

    <!-- Scripts JavaScript -->
    <script src="../public/js/app.js"></script>
    
    <script>
        // Validation du formulaire
        document.addEventListener('DOMContentLoaded', function() {
            const forms = document.querySelectorAll('#profilForm, #profilFormMobile');
            forms.forEach(form => {
                form.addEventListener('submit', function(e) {
                    const poids = parseFloat(form.querySelector('input[name="poids"]').value);
                    const taille = parseFloat(form.querySelector('input[name="taille"]').value);
                    const age = parseInt(form.querySelector('input[name="age"]').value);
                    
                    if (poids <= 0 || taille <= 0 || age <= 0) {
                        e.preventDefault();
                        alert('Veuillez remplir tous les champs avec des valeurs valides');
                        return;
                    }
                    
                    if (age < 10 || age > 120) {
                        e.preventDefault();
                        alert('L\'âge doit être entre 10 et 120 ans');
                        return;
                    }
                });
            });

            // Appliquer les styles de progression
            const progressBars = document.querySelectorAll('.progress-bar');
            progressBars.forEach(bar => {
                const progress = bar.getAttribute('data-progress');
                if (progress) {
                    bar.style.width = progress + '%';
                }
            });
        });
    </script>
</body>
</html>